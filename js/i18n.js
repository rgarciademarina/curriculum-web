const translations = {
    es: {
        nav: {
            home: "Inicio",
            about: "Sobre mí",
            skills: "Habilidades",
            experience: "Experiencia",
            education: "Formación",
            featured: "Proyectos",
            contact: "Contacto"
        },
        hero: {
            title: "Senior QA Automation Engineer",
            description: "Profesional con más de 24 años de experiencia en el sector tecnológico, especializado en los últimos 8+ años en QA y testing automatizado. Mi trayectoria abarca desde roles técnicos hasta la transformación de la calidad del software a través de la automatización inteligente y la innovación continua.",
            downloadCV: "Descargar CV",
            contact: "Contactar"
        },
        about: {
            title: "Sobre Mí",
            innovation: {
                title: "Innovación y Tecnología",
                description: "Como Ingeniero QA Senior especializado en Automatización, combino mi pasión por la tecnología con un compromiso inquebrantable por la calidad del software. Mi reciente inmersión en el campo de la Inteligencia Artificial a través de mi máster me ha permitido expandir mis horizontes y aplicar estas tecnologías emergentes en la mejora de procesos de testing."
            },
            learning: {
                title: "Aprendizaje Continuo",
                description: "En un campo tan dinámico como el desarrollo de software, creo firmemente en la importancia del aprendizaje continuo. Mi experiencia con realidad virtual y tecnologías emergentes no solo refleja mi curiosidad tecnológica, sino también mi capacidad para adaptarme y evolucionar con la industria."
            },
            balance: {
                title: "Balance y Valores",
                description: "Más allá del código, soy un defensor del equilibrio trabajo-vida y el respeto por nuestro entorno. Mi amor por los animales y la naturaleza, reflejado en la vida con mis dos gatos, me aporta una perspectiva única en la resolución de problemas y el trabajo en equipo."
            },
            explorer: {
                title: "Espíritu Explorador",
                description: "Mi fascinación por explorar lugares históricos refleja mi curiosidad innata y deseo de aprender. Esta misma pasión por descubrir me impulsa en mi carrera profesional, donde cada proyecto es una oportunidad para explorar nuevas tecnologías y metodologías."
            },
            horizons: {
                title: "Nuevos Horizontes",
                description: "Como la navegación hacia nuevos horizontes, mi trayectoria profesional está marcada por la búsqueda constante de crecimiento y evolución. Cada proyecto es una oportunidad para expandir fronteras y descubrir nuevas formas de aportar valor a través de la innovación en QA."
            },
            values: {
                title: "Valores y Lealtad",
                description: "La relación con mis gatos me ha enseñado valiosas lecciones sobre lealtad, simplicidad y autenticidad. Estos valores se reflejan en mi ética profesional, donde priorizo la honestidad en las relaciones laborales y la búsqueda de soluciones efectivas sin complicaciones innecesarias.",
                teamwork: "Trabajo en Equipo",
                empathy: "Empatía",
                responsibility: "Responsabilidad",
                curiosity: "Curiosidad",
                exploration: "Exploración",
                adaptability: "Adaptabilidad",
                growth: "Crecimiento",
                vision: "Visión",
                loyalty: "Lealtad",
                simplicity: "Simplicidad",
                authenticity: "Autenticidad"
            },
            tech: {
                newTech: "Nuevas Tecnologías",
                vrAr: "VR/AR",
                innovation: "Innovación",
                teamwork: "Trabajo en Equipo",
                empathy: "Empatía",
                responsibility: "Responsabilidad",
                curiosity: "Curiosidad",
                exploration: "Exploración",
                adaptability: "Adaptabilidad",
                growth: "Crecimiento",
                vision: "Visión",
                loyalty: "Lealtad",
                simplicity: "Simplicidad",
                authenticity: "Autenticidad"
            }
        },
        experience: {
            title: "Experiencia Profesional",
            current: "Presente",
            showMore: "Ver más experiencia",
            showLess: "Ver menos",
            roles: {
                qaEngineer: "Ingeniero QA Senior de Automatización",
                tester: "Tester",
                developer: "Desarrollador"
            },
            kairos: {
                detail1: "Desarrollo de historias de usuario y toma de requisitos en equipo Scrum",
                detail2: "Automatización de pruebas frontend para iOS usando XCUITest",
                detail3: "Pruebas automatizadas de backend con Karate",
                detail4: "Testing de rendimiento utilizando JMeter",
                detail5: "Creación de casos de prueba manuales para historias de usuario y pruebas de regresión"
            },
            sopra: {
                roles: {
                    qe: "Quality Experience Team (2020-2021)",
                    diy: "Do It Yourself Team (2019-2020)"
                },
                qe: {
                    achievements: {
                        1: "Mantenimiento y mejoras del framework (Node.js, Cucumber, Appium)",
                        2: "Revisión de Pull Requests de pruebas",
                        3: "Soporte para creación y resolución de problemas en pruebas e2e"
                    }
                },
                diy: {
                    achievements: {
                        1: "QA Tester en equipo Scrum con TDD",
                        2: "Automatización con Cucumber y Selenium",
                        3: "Creación de planes de prueba"
                    }
                }
            }
        },
        education: {
            title: "Formación",
            formal: "Educación Formal",
            certifications: "Certificaciones Profesionales",
            specialized: "Formación Especializada",
            degrees: {
                aiMaster: {
                    title: "Máster en Ingeniería de IA",
                    institution: "Lidr.co"
                },
                telecommunications: {
                    title: "Grado en Sistemas de Telecomunicación y Computadores"
                }
            },
            certs: {
                istqb: {
                    title: "ISTQB Certified Tester",
                    level: "Foundation Level (CTFL)"
                },
                oracle: {
                    title: "Oracle Certified Professional",
                    level: "Java SE 6 Programmer"
                }
            },
            courses: {
                selenium: {
                    title: "Selenium WebDriver con Java"
                },
                spring: {
                    title: "Desarrollo Web con Spring MVC/Rest",
                    subtitle: "Web Flow y JPA"
                },
                patterns: {
                    title: "Catálogo de Patrones Java OpenSource"
                }
            },
            tech: {
                ai: "Inteligencia Artificial",
                ml: "Machine Learning",
                dataScience: "Data Science",
                telecom: "Telecomunicaciones",
                systems: "Sistemas",
                computing: "Computación",
                testing: "Testing",
                qa: "QA",
                java: "Java",
                automation: "Automatización",
                spring: "Spring",
                rest: "REST",
                jpa: "JPA",
                patterns: "Patrones",
                opensource: "OpenSource"
            }
        },
        contact: {
            title: "Contacto",
            info: "Información de Contacto",
            form: {
                name: "Nombre",
                email: "Email",
                company: "Empresa",
                subject: "Asunto",
                message: "Mensaje",
                send: "Enviar Mensaje",
                verification: "Verificación: ¿Cuánto es 2 + 3?"
            }
        },
        footer: {
            rights: "Todos los derechos reservados."
        },
        featured: {
            title: "Proyectos Destacados",
            aiAssistant: {
                title: "Asistente de Historias de Usuario con IA",
                description: "Desarrollo de una herramienta innovadora que utiliza Inteligencia Artificial para asistir en la creación y mejora de historias de usuario, facilitando el proceso de desarrollo ágil."
            },
            curriculumWeb: {
                title: "Curriculum Web Interactivo",
                description: "¿Te gusta este curriculum web? Échale un vistazo al código fuente. Desarrollado con HTML5, CSS3 y JavaScript, incorpora características modernas como modo oscuro, internacionalización y diseño responsive."
            },
            viewCode: "Ver Código",
            playGame: "Jugar Minotaur Maze"
        },
        skills: {
            title: "Especialidades",
            automation: "Automatización",
            languages: "Lenguajes",
            innovation: "Innovación"
        },
        qr: {
            scan: "Escanea mi tarjeta de contacto",
            viewProfile: "Ver perfil completo"
        }
    },
    en: {
        nav: {
            home: "Home",
            about: "About me",
            skills: "Skills",
            experience: "Experience",
            education: "Education",
            featured: "Projects",
            contact: "Contact"
        },
        hero: {
            title: "Senior QA Automation Engineer",
            description: "Professional with over 24 years of experience in the technology sector, specialized in QA and automated testing for the last 8+ years. My career spans from technical roles to transforming software quality through intelligent automation and continuous innovation.",
            downloadCV: "Download CV",
            contact: "Contact"
        },
        about: {
            title: "About Me",
            innovation: {
                title: "Innovation and Technology",
                description: "As a Senior QA Engineer specialized in Automation, I combine my passion for technology with an unwavering commitment to software quality. My recent immersion in the field of Artificial Intelligence through my master's degree has allowed me to expand my horizons and apply these emerging technologies to improve testing processes."
            },
            learning: {
                title: "Continuous Learning",
                description: "In a field as dynamic as software development, I firmly believe in the importance of continuous learning. My experience with virtual reality and emerging technologies not only reflects my technological curiosity but also my ability to adapt and evolve with the industry."
            },
            balance: {
                title: "Balance and Values",
                description: "Beyond code, I am an advocate for work-life balance and respect for our environment. My love for animals and nature, reflected in life with my two cats, gives me a unique perspective on problem-solving and teamwork."
            },
            explorer: {
                title: "Explorer Spirit",
                description: "My fascination with exploring historical places reflects my innate curiosity and desire to learn. This same passion for discovery drives me in my professional career, where each project is an opportunity to explore new technologies and methodologies."
            },
            horizons: {
                title: "New Horizons",
                description: "Like navigation towards new horizons, my professional journey is marked by the constant pursuit of growth and evolution. Each project is an opportunity to expand boundaries and discover new ways to add value through innovation in QA."
            },
            values: {
                title: "Values and Loyalty",
                description: "My relationship with my cats has taught me valuable lessons about loyalty, simplicity, and authenticity. These values are reflected in my professional ethics, where I prioritize honesty in work relationships and the pursuit of effective solutions without unnecessary complications.",
                teamwork: "Team Work",
                empathy: "Empathy",
                responsibility: "Responsibility",
                curiosity: "Curiosity",
                exploration: "Exploration",
                adaptability: "Adaptability",
                growth: "Growth",
                vision: "Vision",
                loyalty: "Loyalty",
                simplicity: "Simplicity",
                authenticity: "Authenticity"
            },
            tech: {
                newTech: "New Technologies",
                vrAr: "VR/AR",
                innovation: "Innovation",
                teamwork: "Team Work",
                empathy: "Empathy",
                responsibility: "Responsibility",
                curiosity: "Curiosity",
                exploration: "Exploration",
                adaptability: "Adaptability",
                growth: "Growth",
                vision: "Vision",
                loyalty: "Loyalty",
                simplicity: "Simplicity",
                authenticity: "Authenticity"
            }
        },
        experience: {
            title: "Professional Experience",
            current: "Present",
            showMore: "Show More",
            showLess: "Show Less",
            roles: {
                qaEngineer: "Senior QA Automation Engineer",
                tester: "Tester",
                developer: "Developer"
            },
            steelmood: {
                detail1: "Functional test automation for Carrefour's e-commerce platform",
                detail2: "Development of test scripts using Java, Selenium and Rest Assured",
                detail3: "Implementation of BDD methodology with Cucumber",
                detail4: "Integration of automated tests in CI/CD pipeline",
                detail5: "Creation and maintenance of test documentation in Jira"
            },
            tsystems: {
                detail1: "Functional testing for Allianz insurance applications",
                detail2: "Test planning and execution using Silk Central",
                detail3: "Defect reporting and tracking through the development lifecycle"
            },
            alalza: {
                detail1: "Technical support for roaming services",
                detail2: "Troubleshooting of VoIP and LTE connectivity issues",
                detail3: "Network configuration and monitoring",
                detail4: "Customer support for international roaming services",
                detail5: "Documentation of technical procedures",
                detail6: "Collaboration with international carriers for service integration"
            },
            capitole: {
                detail1: "Creation and maintenance of automation framework",
                detail2: "Systems integration testing",
                detail3: "Quality control and test documentation"
            },
            zemsania: {
                detail1: "Test automation with Selenium and Cucumber using Java with Maven",
                detail2: "SOAP web services testing with SoapUI",
                detail3: "Design and execution of manual and automated test plans",
                detail4: "Test centralization using TestLink"
            },
            alten: {
                detail1: "Development of hybrid Android and iOS applications with Ionic",
                detail2: "Test plan development using BDD",
                detail3: "Automation with Selenium, Appium and Specflow in C#",
                detail4: "Cloud testing with Perfecto Mobile",
                detail5: "Test management with TFS"
            },
            urende: {
                detail1: "Sale of computers, consumer electronics and new technologies",
                detail2: "Sale of telephone and internet services, fixed and mobile",
                detail3: "Documentation management for credits through SRS Santander group",
                detail4: "Organization of transport routes",
                detail5: "Implementation of material entries"
            },
            adecom: {
                detail1: "Installation of ATMs for Caja Rural throughout Ciudad Real province",
                detail2: "Maintenance of dispensers, recyclers, PR2 printers and computers for Getronics"
            },
            garcia: {
                detail1: "Monitoring, management and repair of Siemens automatic storage system (26,000 pallets)",
                detail2: "Maintenance and cleaning of stacker cranes",
                detail3: "Support in production line when needed"
            },
            setico: {
                detail1: "Installation and maintenance of office equipment (analog and digital photocopiers, faxes, printers)",
                detail2: "Cleaning and setup of second-hand photocopiers for resale"
            },
            lanza: {
                detail1: "Layout of newspaper pages",
                detail2: "Maintenance and updating of Web publication"
            },
            icaldia: {
                detail1: "Installation and maintenance of computer networks",
                detail2: "Implementation of telephone systems"
            },
            torreon: {
                detail1: "Implementation, management and maintenance of the institute's computer network"
            },
            sopra: {
                roles: {
                    qe: "Quality Experience Team (2020-2021)",
                    diy: "Do It Yourself Team (2019-2020)"
                },
                qe: {
                    achievements: {
                        1: "Framework maintenance and improvements (Node.js, Cucumber, Appium)",
                        2: "Test Pull Request reviews",
                        3: "Support for e2e test creation and troubleshooting"
                    }
                },
                diy: {
                    achievements: {
                        1: "QA Tester in Scrum team with TDD",
                        2: "Automation with Cucumber and Selenium",
                        3: "Test plan creation"
                    }
                }
            }
        },
        education: {
            title: "Education",
            formal: "Formal Education",
            certifications: "Professional Certifications",
            specialized: "Specialized Training",
            degrees: {
                aiMaster: {
                    title: "Master's in AI Engineering",
                    institution: "Lidr.co"
                },
                telecommunications: {
                    title: "Degree in Telecommunications Systems and Computers"
                }
            },
            certs: {
                istqb: {
                    title: "ISTQB Certified Tester",
                    level: "Foundation Level (CTFL)"
                },
                oracle: {
                    title: "Oracle Certified Professional",
                    level: "Java SE 6 Programmer"
                }
            },
            courses: {
                selenium: {
                    title: "Selenium WebDriver with Java"
                },
                spring: {
                    title: "Web Development with Spring MVC/Rest",
                    subtitle: "Web Flow and JPA"
                },
                patterns: {
                    title: "Java OpenSource Design Patterns Catalog"
                }
            },
            tech: {
                ai: "Artificial Intelligence",
                ml: "Machine Learning",
                dataScience: "Data Science",
                telecom: "Telecommunications",
                systems: "Systems",
                computing: "Computing",
                testing: "Testing",
                qa: "QA",
                java: "Java",
                automation: "Automation",
                spring: "Spring",
                rest: "REST",
                jpa: "JPA",
                patterns: "Patterns",
                opensource: "OpenSource"
            }
        },
        contact: {
            title: "Contact",
            info: "Contact Information",
            form: {
                name: "Name",
                email: "Email",
                company: "Company",
                subject: "Subject",
                message: "Message",
                send: "Send Message",
                verification: "Verification: What is 2 + 3?"
            }
        },
        footer: {
            rights: "All rights reserved."
        },
        featured: {
            title: "Featured Projects",
            aiAssistant: {
                title: "AI User Story Assistant",
                description: "Development of an innovative tool that uses Artificial Intelligence to assist in the creation and improvement of user stories, facilitating the agile development process."
            },
            curriculumWeb: {
                title: "Interactive Web Resume",
                description: "Like this web resume? Take a look at the source code. Built with HTML5, CSS3, and JavaScript, it features modern capabilities like dark mode, internationalization, and responsive design."
            },
            viewCode: "View Code",
            playGame: "Play Minotaur Maze"
        },
        skills: {
            title: "Specialties",
            automation: "Automation",
            languages: "Languages",
            innovation: "Innovation"
        },
        qr: {
            scan: "Scan my contact card",
            viewProfile: "View full profile"
        }
    }
};

class I18nManager {
    constructor() {
        // Obtener el idioma de la URL si existe
        const urlParams = new URLSearchParams(window.location.search);
        const langParam = urlParams.get('lang');
        
        // Usar el parámetro de la URL si es válido, si no usar localStorage o español por defecto
        if (langParam && ['es', 'en'].includes(langParam.toLowerCase())) {
            this.currentLang = langParam.toLowerCase();
            localStorage.setItem('preferredLanguage', this.currentLang);
        } else {
            this.currentLang = localStorage.getItem('preferredLanguage') || 'es';
        }
        
        this.init();
    }

    init() {
        this.updateLanguageButton();
        this.translatePage();
        this.setupEventListeners();
    }

    setupEventListeners() {
        const langToggle = document.getElementById('langToggle');
        if (langToggle) {
            langToggle.addEventListener('click', () => this.toggleLanguage());
        }
    }

    toggleLanguage() {
        // Guardar el idioma anterior para referencia
        const previousLang = this.currentLang;
        
        // Cambiar idioma
        this.currentLang = this.currentLang === 'es' ? 'en' : 'es';
        localStorage.setItem('preferredLanguage', this.currentLang);
        
        // Actualizar la URL cuando se cambia el idioma
        const url = new URL(window.location.href);
        url.searchParams.set('lang', this.currentLang);
        window.history.replaceState({}, '', url);
        
        console.log(`Language changed from ${previousLang} to ${this.currentLang}`);
        
        // Actualizar el botón y traducir la página
        this.updateLanguageButton();
        
        // Ejecutar traducción inmediata
        this.translatePage();
        
        // Segunda pasada después de un retardo
        setTimeout(() => {
            this.translatePage();
            
            // Verificar y corregir específicamente la tercera experiencia (Capitole)
            const thirdExperience = document.querySelectorAll('.timeline-item')[2];
            if (thirdExperience) {
                const items = thirdExperience.querySelectorAll('[data-i18n]');
                items.forEach(item => {
                    this.translateElement(item);
                });
            }
            
            console.log("Second translation pass completed");
        }, 100);
        
        // Recargar los componentes dinámicos para asegurar que se traduzcan
        if (window.componentsLoader) {
            setTimeout(() => {
                window.componentsLoader.loadExperienceData();
                console.log("Dynamic components reloaded");
            }, 150);
        }
    }

    updateLanguageButton() {
        const langToggle = document.getElementById('langToggle');
        if (langToggle) {
            langToggle.innerHTML = `<i class="bi bi-translate"></i> ${this.currentLang === 'es' ? 'EN' : 'ES'}`;
        }
    }

    translatePage() {
        this.performTranslation();
        
        // Enfocarse específicamente en experiencias problemáticas
        document.querySelectorAll('.timeline-item:nth-child(n+3) [data-i18n]').forEach(element => {
            this.translateElement(element, true);
        });

        setTimeout(() => {
            this.performTranslation();
        }, 50);
    }
    
    // Método que realiza la traducción real
    performTranslation() {
        // Primero, traducir todos los elementos con el atributo data-i18n
        document.querySelectorAll('[data-i18n]').forEach(element => {
            this.translateElement(element);
        });

        // Actualizar elementos del DOM que tienen periodos de fecha
        const timelineItems = document.querySelectorAll('.timeline-item');
        const monthsEN = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        const monthsES = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
        
        timelineItems.forEach(item => {
            const dateElement = item.querySelector('.timeline-date');
            if (!dateElement) return;
            
            // Traducir "Present" / "Presente"
            if (dateElement.textContent.includes(translations.es.experience.current) && this.currentLang === 'en') {
                dateElement.textContent = dateElement.textContent.replace(translations.es.experience.current, translations.en.experience.current);
            } else if (dateElement.textContent.includes(translations.en.experience.current) && this.currentLang === 'es') {
                dateElement.textContent = dateElement.textContent.replace(translations.en.experience.current, translations.es.experience.current);
            }
            
            // Traducir meses
            if (this.currentLang === 'es') {
                monthsEN.forEach((month, index) => {
                    if (dateElement.textContent.includes(month)) {
                        dateElement.textContent = dateElement.textContent.replace(month, monthsES[index]);
                    }
                });
            } else {
                monthsES.forEach((month, index) => {
                    if (dateElement.textContent.includes(month)) {
                        dateElement.textContent = dateElement.textContent.replace(month, monthsEN[index]);
                    }
                });
            }
            
            // Asegurar que todos los elementos con data-i18n dentro del item se traduzcan
            const elementsWithI18n = item.querySelectorAll('[data-i18n]');
            elementsWithI18n.forEach(element => {
                this.translateElement(element);
            });
        });
    }
    
    // Método auxiliar para traducir un elemento según su atributo data-i18n
    translateElement(element, debug = false) {
        const key = element.dataset.i18n;
        if (!key) return;
        
        const keys = key.split('.');
        if (keys.length < 2) {
            console.warn('Invalid translation key:', key);
            return;
        }
        
        let value = translations[this.currentLang];
        
        // Construir el camino completo para depuración
        let fullPath = this.currentLang;
        
        for (const keyPart of keys) {
            if (!value) break;
            
            fullPath += '.' + keyPart;
            value = value[keyPart];
            
            if (debug && !value) {
                console.error(`Translation not found for path: ${fullPath}`);
            }
        }
        
        // Si no encontramos traducción, intentar buscar una alternativa (compatibilidad hacia atrás)
        if (!value && key.includes('achievements')) {
            // Intentar convertir achievements.N a detailN
            const alternativeKey = key.replace(/achievements\.(\d+)/, "detail$1");
            
            if (debug) {
                console.log(`Trying alternative key: ${alternativeKey}`);
            }
            
            const altKeys = alternativeKey.split('.');
            let altValue = translations[this.currentLang];
            
            for (const altKeyPart of altKeys) {
                if (!altValue) break;
                altValue = altValue[altKeyPart];
            }
            
            if (altValue) {
                value = altValue;
                if (debug) {
                    console.log(`Found alternative translation: ${value}`);
                }
            }
        }
        
        if (value) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                element.placeholder = value;
            } else {
                element.textContent = value;
            }
            if (debug) {
                console.log(`Translated ${key} to "${value}"`);
            }
        } else if (debug) {
            console.warn(`No translation found for ${key} in language ${this.currentLang}`);
        }
    }

    getText(key) {
        const keys = key.split('.');
        let value = translations[this.currentLang];
        
        for (const k of keys) {
            if (value) value = value[k];
        }
        
        return value || key;
    }
}

// Inicializar el gestor de idiomas cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', () => {
    // Establecer el idioma español por defecto si no hay ninguno guardado
    if (!localStorage.getItem('preferredLanguage')) {
        localStorage.setItem('preferredLanguage', 'es');
    }
    window.i18n = new I18nManager();
});
